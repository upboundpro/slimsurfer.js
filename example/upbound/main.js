'use strict';

// Create an instance
var slimsurfer;

// Init & load audio file
document.addEventListener('DOMContentLoaded', function() {
    var container = document.querySelector('.waveform.wf1');
    // Init
    slimsurfer = SlimSurfer.create({
        container: container,
        waveColor: '#A8DBA8',
        progressColor: '#3B8686',
        height: container.offsetHeight,
        normalize: true,
        plugins: [SlimSurfer.cursor.create()],
        responsive: true,
        backend: 'MediaElement'
    });
    //slimsurfer.setHeight(800);

    // Load peaks
    slimsurfer.load(
        [
            0.11818811506032943,
            0.10820856153964996,
            0.1608224755525589,
            0.13585833668708802,
            0.14040558993816377,
            0.1290221905708313,
            0.12185033619403839,
            0.16021210908889771,
            0.08992797344923019,
            0.061240578293800356,
            0.11708945244550704,
            0.046286506801843645,
            0.05321420937776566,
            0.07506546586751937,
            0.25930571019649507,
            0.12294900625944137,
            0.16048676729202271,
            0.11467848926782608,
            0.12691641062498094,
            0.09780175447463989,
            0.15065980911254884,
            0.09932767808437347,
            0.1374758130311966,
            0.14898129761219026,
            0.17248054802417756,
            0.15731284976005555,
            0.33880643010139466,
            0.11760826617479324,
            0.12517685651779176,
            0.16387432277202607,
            0.24249000310897828,
            0.1689404046535492,
            0.13308114767074586,
            0.12792352050542832,
            0.20531846046447755,
            0.11458692908287048,
            0.186458016037941,
            0.1846879518032074,
            0.138543958067894,
            0.03960295416414738,
            0.038229622170329096,
            0.11138248652219772,
            0.15111758768558503,
            0.15099551737308503,
            0.12734367161989213,
            0.104576857984066,
            0.06096591264009476,
            0.054892728328704836,
            0.08300027459859848,
            0.0500402843952179,
            0.2089501565694809,
            0.13936796247959138,
            0.13552262842655183,
            0.18401653528213502,
            0.15999847114086152,
            0.08666249573230743,
            0.09532975614070892,
            0.06288857594132423,
            0.046286506801843645,
            0.15731284976005555,
            0.12743522435426713,
            0.13369152158498765,
            0.14806574046611787,
            0.10891048818826675,
            0.0381075481325388,
            0.1621958112716675,
            0.09023316413164138,
            0.15825892448425294,
            0.2820114886760712,
            0.07634724140167236,
            0.11467848926782608,
            0.120812708735466,
            0.03807702869176865,
            0.03133243903517723,
            0.16717032551765443,
            0.06645924434065818,
            0.11092470794916152,
            0.1779738759994507,
            0.12352885514497756,
            0.07912442296743392,
            0.16045624971389771,
            0.15636677503585816,
            0.23074037790298463,
            0.2322968190908432,
            0.7969808077812195,
            0.1771498715877533,
            0.16439313650131226,
            0.15007996022701264,
            0.11757774859666824,
            0.05681539535522461,
            0.14260293006896974,
            0.12737418919801713,
            0.1468755102157593,
            0.04256325051188469,
            0.03703939937055111,
            0.03633747458457947,
            0.04024384379386902,
            0.09944974839687347,
            0.13875759601593018,
            0.0727155378460884,
            0.1290527081489563,
            0.14306070864200593,
            0.19100528419017793,
            0.1940266138315201,
            0.13228766828775407,
            0.0970998278260231,
            0.17870632767677308,
            0.24752555251121522,
            0.20519639015197755,
            0.1306396669149399,
            0.13393566966056825,
            0.09429212123155593,
            0.11415967553853988,
            0.07064027920365333,
            0.1544746255874634,
            0.153375962972641,
            0.11956145077943801,
            0.04906369209289551,
            0.03175969816744328,
            0.0733564293384552,
            0.06240027979016304,
            0.10772026538848876,
            0.10994811564683914,
            0.13567521631717683,
            0.11074160248041152,
            0.11162663459777832,
            0.18368084192276002,
            0.09603167533874511,
            0.10772026538848876,
            0.1295410043001175
        ],
        200 // TODO get duration on server side
    );

    slimsurfer.seekTo(0.5);
    /*
    slimsurfer.drawer.updateSize()
    slimsurfer.empty();
    slimsurfer.drawBuffer();
    */

    slimsurfer.on('interaction', function(e, progress) {
        // console.log("Beat: User interacted");
        slimsurfer.seekTo(progress);
    });
    /*
    slimsurfer.on('redraw', function () {
      console.log("Wavesurfer: redraw");
      //slimsurfer.empty();
      //slimsurfer.drawBuffer();
    })
    */

    /*
    document
        .querySelector('[data-action="play"]')
        .addEventListener('click', slimsurfer.playPause.bind(slimsurfer));
    */

    /*
    document
        .querySelector('[data-action="peaks"]')
        .addEventListener('click', function() {
            slimsurfer.load('../media/demo.wav', [
                0.0218,
                0.0183,
                0.0165,
                0.0198,
                0.2137,
                0.2888,
                0.2313,
                0.15,
                0.2542,
                0.2538,
                0.2358,
                0.1195,
                0.1591,
                0.2599,
                0.2742,
                0.1447,
                0.2328,
                0.1878,
                0.1988,
                0.1645,
                0.1218,
                0.2005,
                0.2828,
                0.2051,
                0.1664,
                0.1181,
                0.1621,
                0.2966,
                0.189,
                0.246,
                0.2445,
                0.1621,
                0.1618,
                0.189,
                0.2354,
                0.1561,
                0.1638,
                0.2799,
                0.0923,
                0.1659,
                0.1675,
                0.1268,
                0.0984,
                0.0997,
                0.1248,
                0.1495,
                0.1431,
                0.1236,
                0.1755,
                0.1183,
                0.1349,
                0.1018,
                0.1109,
                0.1833,
                0.1813,
                0.1422,
                0.0961,
                0.1191,
                0.0791,
                0.0631,
                0.0315,
                0.0157,
                0.0166,
                0.0108
            ]);
            document.body.scrollTop = 0;
        });
      */
});
