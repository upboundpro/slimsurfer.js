/*!
 * slimsurfer.js regions plugin 4.0.1 (2020-07-20)
 * https://github.com/upboundpro/slimsurfer.js
 * @license BSD-3-Clause
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("regions",[],t):"object"==typeof exports?exports.regions=t():(e.SlimSurfer=e.SlimSurfer||{},e.SlimSurfer.regions=t())}(this,(function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="localhost:8080/dist/plugin/",r(r.s=5)}({5:function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(){function e(t,r){var n=this;i(this,e),this.slimsurfer=r,this.wrapper=r.drawer.wrapper,this.util=r.util,this.style=this.util.style,this.id=null==t.id?r.util.getId():t.id,this.start=Number(t.start)||0,this.end=null==t.end?this.start+4/this.wrapper.scrollWidth*this.slimsurfer.getDuration():Number(t.end),this.resize=void 0===t.resize||Boolean(t.resize),this.drag=void 0===t.drag||Boolean(t.drag),this.loop=Boolean(t.loop),this.color=t.color||"rgba(0, 0, 0, 0.1)",this.data=t.data||{},this.attributes=t.attributes||{},this.maxLength=t.maxLength,this.minLength=t.minLength,this._onRedraw=function(){return n.updateRender()},this.scroll=!1!==t.scroll&&r.params.scrollParent,this.scrollSpeed=t.scrollSpeed||1,this.scrollThreshold=t.scrollThreshold||10,this.bindInOut(),this.render(),this.slimsurfer.on("zoom",this._onRedraw),this.slimsurfer.on("redraw",this._onRedraw),this.slimsurfer.fireEvent("region-created",this)}return s(e,[{key:"update",value:function(e){null!=e.start&&(this.start=Number(e.start)),null!=e.end&&(this.end=Number(e.end)),null!=e.loop&&(this.loop=Boolean(e.loop)),null!=e.color&&(this.color=e.color),null!=e.data&&(this.data=e.data),null!=e.resize&&(this.resize=Boolean(e.resize)),null!=e.drag&&(this.drag=Boolean(e.drag)),null!=e.maxLength&&(this.maxLength=Number(e.maxLength)),null!=e.minLength&&(this.minLength=Number(e.minLength)),null!=e.attributes&&(this.attributes=e.attributes),this.updateRender(),this.fireEvent("update"),this.slimsurfer.fireEvent("region-updated",this)}},{key:"remove",value:function(){this.element&&(this.wrapper.removeChild(this.element),this.element=null,this.fireEvent("remove"),this.slimsurfer.un("zoom",this._onRedraw),this.slimsurfer.un("redraw",this._onRedraw),this.slimsurfer.fireEvent("region-removed",this))}},{key:"play",value:function(){this.slimsurfer.play(this.start,this.end),this.fireEvent("play"),this.slimsurfer.fireEvent("region-play",this)}},{key:"playLoop",value:function(){var e=this;this.play(),this.once("out",(function(){return e.playLoop()}))}},{key:"render",value:function(){var e=document.createElement("region");for(var t in e.className="slimsurfer-region",e.title=this.formatTime(this.start,this.end),e.setAttribute("data-id",this.id),this.attributes)e.setAttribute("data-region-"+t,this.attributes[t]);this.wrapper.scrollWidth;if(this.style(e,{position:"absolute",zIndex:2,height:"100%",top:"0px"}),this.resize){var r=e.appendChild(document.createElement("handle")),i=e.appendChild(document.createElement("handle"));r.className="slimsurfer-handle slimsurfer-handle-start",i.className="slimsurfer-handle slimsurfer-handle-end";var n={cursor:"col-resize",position:"absolute",left:"0px",top:"0px",width:"1%",maxWidth:"4px",height:"100%"};this.style(r,n),this.style(i,n),this.style(i,{left:"100%"})}this.element=this.wrapper.appendChild(e),this.updateRender(),this.bindEvents(e)}},{key:"formatTime",value:function(e,t){return(e==t?[e]:[e,t]).map((function(e){return[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2)].join(":")})).join("-")}},{key:"getWidth",value:function(){return this.slimsurfer.drawer.width/this.slimsurfer.params.pixelRatio}},{key:"updateRender",value:function(){var e=this.slimsurfer.getDuration(),t=this.getWidth();if(this.start<0&&(this.start=0,this.end=this.end-this.start),this.end>e&&(this.end=e,this.start=e-(this.end-this.start)),null!=this.minLength&&(this.end=Math.max(this.start+this.minLength,this.end)),null!=this.maxLength&&(this.end=Math.min(this.start+this.maxLength,this.end)),null!=this.element){var r=Math.round(this.start/e*t),i=Math.round(this.end/e*t)-r;for(var n in this.style(this.element,{left:r+"px",width:i+"px",backgroundColor:this.color,cursor:this.drag?"move":"default"}),this.attributes)this.element.setAttribute("data-region-"+n,this.attributes[n]);this.element.title=this.formatTime(this.start,this.end)}}},{key:"bindInOut",value:function(){var e=this;this.firedIn=!1,this.firedOut=!1;var t=function(t){!e.firedOut&&e.firedIn&&(e.start>=Math.round(100*t)/100||e.end<=Math.round(100*t)/100)&&(e.firedOut=!0,e.firedIn=!1,e.fireEvent("out"),e.slimsurfer.fireEvent("region-out",e)),!e.firedIn&&e.start<=t&&e.end>t&&(e.firedIn=!0,e.firedOut=!1,e.fireEvent("in"),e.slimsurfer.fireEvent("region-in",e))};this.slimsurfer.backend.on("audioprocess",t),this.on("remove",(function(){e.slimsurfer.backend.un("audioprocess",t)})),this.on("out",(function(){e.loop&&e.slimsurfer.play(e.start)}))}},{key:"bindEvents",value:function(){var e,t,r,i,n,s,o,a,l,u,h,d,c,f,m,p=this;this.element.addEventListener("mouseenter",(function(e){p.fireEvent("mouseenter",e),p.slimsurfer.fireEvent("region-mouseenter",p,e)})),this.element.addEventListener("mouseleave",(function(e){p.fireEvent("mouseleave",e),p.slimsurfer.fireEvent("region-mouseleave",p,e)})),this.element.addEventListener("click",(function(e){e.preventDefault(),p.fireEvent("click",e),p.slimsurfer.fireEvent("region-click",p,e)})),this.element.addEventListener("dblclick",(function(e){e.stopPropagation(),e.preventDefault(),p.fireEvent("dblclick",e),p.slimsurfer.fireEvent("region-dblclick",p,e)})),(this.drag||this.resize)&&(a=p.slimsurfer.drawer.container,l=p.slimsurfer.getDuration(),u=p.scrollSpeed,h=p.scrollThreshold,d=!1,c=function(s){s.touches&&s.touches.length>1||(t=s.targetTouches?s.targetTouches[0].identifier:null,s.stopPropagation(),e=p.slimsurfer.drawer.handleEvent(s,!0)*l,i=p.wrapper.scrollWidth-p.wrapper.clientWidth,o=p.wrapper.getBoundingClientRect(),"handle"==s.target.tagName.toLowerCase()?n=s.target.classList.contains("slimsurfer-handle-start")?"start":"end":(r=!0,n=!1))},f=function(e){e.touches&&e.touches.length>1||((r||n)&&(r=!1,s=null,n=!1),d&&(d=!1,p.util.preventClick(),p.fireEvent("update-end",e),p.slimsurfer.fireEvent("region-update-end",p,e)))},m=function(c){if(!(c.touches&&c.touches.length>1)&&(!c.targetTouches||c.targetTouches[0].identifier==t)&&(r||n)){var f=e,m=p.slimsurfer.drawer.handleEvent(c)*l,v=m-e;if(e=m,p.drag&&r&&(d=d||!!v,p.onDrag(v)),p.resize&&n&&(d=d||!!v,p.onResize(v,n)),p.scroll&&a.clientWidth<p.wrapper.scrollWidth){if(r){var g=p.element.getBoundingClientRect(),y=g.left-o.left;m<f&&y>=0?s=-1:m>f&&y+g.width<=o.right&&(s=1),(-1===s&&y>h||1===s&&y+g.width<o.right-h)&&(s=null)}else{var b=c.clientX-o.left;s=b<=h?-1:b>=o.right-h?1:null}s&&function t(o){if(s&&(r||n)){var a=p.wrapper.scrollLeft+u*s;p.wrapper.scrollLeft=a=Math.min(i,Math.max(0,a));var h=p.slimsurfer.drawer.handleEvent(o)*l,d=h-e;e=h,r?p.onDrag(d):p.onResize(d,n),window.requestAnimationFrame((function(){t(o)}))}}(c)}}},p.element.addEventListener("mousedown",c),p.element.addEventListener("touchstart",c),p.wrapper.addEventListener("mousemove",m),p.wrapper.addEventListener("touchmove",m),document.body.addEventListener("mouseup",f),document.body.addEventListener("touchend",f),p.on("remove",(function(){document.body.removeEventListener("mouseup",f),document.body.removeEventListener("touchend",f),p.wrapper.removeEventListener("mousemove",m),p.wrapper.removeEventListener("touchmove",m)})),p.slimsurfer.on("destroy",(function(){document.body.removeEventListener("mouseup",f),document.body.removeEventListener("touchend",f)})))}},{key:"onDrag",value:function(e){var t=this.slimsurfer.getDuration();this.end+e>t||this.start+e<0||this.update({start:this.start+e,end:this.end+e})}},{key:"onResize",value:function(e,t){"start"==t?this.update({start:Math.min(this.start+e,this.end),end:Math.max(this.start+e,this.end)}):this.update({start:Math.min(this.end+e,this.start),end:Math.max(this.end+e,this.start)})}}]),e}(),a=function(){function e(t,r){var n=this;i(this,e),this.params=t,this.slimsurfer=r,this.util=r.util,Object.getOwnPropertyNames(this.util.Observer.prototype).forEach((function(e){o.prototype[e]=n.util.Observer.prototype[e]})),this.slimsurfer.Region=o,this.list={},this._onReady=function(){n.wrapper=n.slimsurfer.drawer.wrapper,n.params.regions&&n.params.regions.forEach((function(e){n.add(e)})),n.params.dragSelection&&n.enableDragSelection(n.params)}}return s(e,null,[{key:"create",value:function(t){return{name:"regions",deferInit:!(!t||!t.deferInit)&&t.deferInit,params:t,staticProps:{initRegions:function(){console.warn('Deprecated initRegions! Use slimsurfer.initPlugins("regions") instead!'),this.initPlugin("regions")},addRegion:function(e){return this.initialisedPluginList.regions||this.initPlugin("regions"),this.regions.add(e)},clearRegions:function(){this.regions&&this.regions.clear()},enableDragSelection:function(e){this.initialisedPluginList.regions||this.initPlugin("regions"),this.regions.enableDragSelection(e)},disableDragSelection:function(){this.regions.disableDragSelection()}},instance:e}}}]),s(e,[{key:"init",value:function(){this.slimsurfer.isReady&&this._onReady(),this.slimsurfer.on("ready",this._onReady)}},{key:"destroy",value:function(){this.slimsurfer.un("ready",this._onReady),this.disableDragSelection(),this.clear()}},{key:"add",value:function(e){var t=this,r=new this.slimsurfer.Region(e,this.slimsurfer);return this.list[r.id]=r,r.on("remove",(function(){delete t.list[r.id]})),r}},{key:"clear",value:function(){var e=this;Object.keys(this.list).forEach((function(t){e.list[t].remove()}))}},{key:"enableDragSelection",value:function(e){var t,r,i,n,s,o,a,l=this,u=e.slop||2,h=this.slimsurfer.drawer.container,d=!1!==e.scroll&&this.slimsurfer.params.scrollParent,c=e.scrollSpeed||1,f=e.scrollThreshold||10,m=this.slimsurfer.getDuration(),p=0,v=function(e){e.touches&&e.touches.length>1||(m=l.slimsurfer.getDuration(),s=e.targetTouches?e.targetTouches[0].identifier:null,r=l.wrapper.scrollWidth-l.wrapper.clientWidth,a=l.wrapper.getBoundingClientRect(),t=!0,i=l.slimsurfer.drawer.handleEvent(e,!0),n=null,o=null)};this.wrapper.addEventListener("mousedown",v),this.wrapper.addEventListener("touchstart",v),this.on("disable-drag-selection",(function(){l.wrapper.removeEventListener("touchstart",v),l.wrapper.removeEventListener("mousedown",v)}));var g=function(e){e.touches&&e.touches.length>1||(t=!1,p=0,o=null,n&&(l.util.preventClick(),n.fireEvent("update-end",e),l.slimsurfer.fireEvent("region-update-end",n,e)),n=null)};this.wrapper.addEventListener("mouseup",g),this.wrapper.addEventListener("touchend",g),document.body.addEventListener("mouseup",g),document.body.addEventListener("touchend",g),this.on("disable-drag-selection",(function(){document.body.removeEventListener("mouseup",g),document.body.removeEventListener("touchend",g),l.wrapper.removeEventListener("touchend",g),l.wrapper.removeEventListener("mouseup",g)}));var y=function(v){if(t&&!(++p<=u||v.touches&&v.touches.length>1||v.targetTouches&&v.targetTouches[0].identifier!=s)){n||(n=l.add(e||{}));var g=l.slimsurfer.drawer.handleEvent(v);if(n.update({start:Math.min(g*m,i*m),end:Math.max(g*m,i*m)}),d&&h.clientWidth<l.wrapper.scrollWidth){var y=v.clientX-a.left;(o=y<=f?-1:y>=a.right-f?1:null)&&function e(t){if(n&&o){var s=l.wrapper.scrollLeft+c*o;l.wrapper.scrollLeft=s=Math.min(r,Math.max(0,s));var a=l.slimsurfer.drawer.handleEvent(t);n.update({start:Math.min(a*m,i*m),end:Math.max(a*m,i*m)}),s<r&&s>0&&window.requestAnimationFrame((function(){e(t)}))}}(v)}}};this.wrapper.addEventListener("mousemove",y),this.wrapper.addEventListener("touchmove",y),this.on("disable-drag-selection",(function(){l.wrapper.removeEventListener("touchmove",y),l.wrapper.removeEventListener("mousemove",y)}))}},{key:"disableDragSelection",value:function(){this.fireEvent("disable-drag-selection")}},{key:"getCurrentRegion",value:function(){var e=this,t=this.slimsurfer.getCurrentTime(),r=null;return Object.keys(this.list).forEach((function(i){var n=e.list[i];n.start<=t&&n.end>=t&&(!r||n.end-n.start<r.end-r.start)&&(r=n)})),r}}]),e}();t.default=a,e.exports=t.default}})}));
//# sourceMappingURL=slimsurfer.regions.min.js.map